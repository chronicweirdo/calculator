<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta content="width=device-width, initial-scale=1" name="viewport"/>
        <script>
            function getViewportWidth() {
                return Math.max(document.documentElement.clientWidth, window.innerWidth || 0)
            }

            function getViewportHeight() {
                return Math.max(document.documentElement.clientHeight, window.innerHeight || 0)
            }

            function calculate(){
                let eq = document.getElementById("equation")
                try {
                    let expression = eq.value
                    let result = Function('"use strict";return (' + expression + ')')()
                    document.getElementById("result").innerHTML = result
                } catch (error) {
                    document.getElementById("result").innerHTML = "?"
                }
                eq.focus()
            }
            function insert(ch) {
                let eq = document.getElementById("equation")
                let currentVal = eq.value
                let start = eq.selectionStart
                let end = eq.selectionEnd
                eq.value = currentVal.slice(0, start) + ch + currentVal.slice(end)
                eq.focus()
                eq.selectionStart = start+1
                eq.selectionEnd = start+1
            }
            function backspace() {
                let eq = document.getElementById("equation")
                let currentVal = eq.value
                let start = eq.selectionStart
                let end = eq.selectionEnd
                if (start == end && start > 0) {
                    eq.value = currentVal.slice(0, start-1) + currentVal.slice(end)
                    eq.selectionStart = start-1
                    eq.selectionEnd = start-1
                } else {
                    eq.value = currentVal.slice(0, start) + currentVal.slice(end)
                    eq.selectionStart = start
                    eq.selectionEnd = start
                }
                eq.focus()
            }
            function cls() {
                let eq = document.getElementById("equation")
                eq.value = ""
                eq.focus()
            }
            function resize() {
                let controls = document.getElementById("controls")
                let equation = document.getElementById("equation")
                let vw = getViewportWidth()
                let vh = getViewportHeight()
                let ch = controls.clientHeight
                let eh = vh - ch
                console.log(vw + " " + vh + " " + ch + " " + eh)
                equation.style.width = (vw - 2) + "px"
                equation.style.height = (eh-10) + "px"
            }
            window.onload = function() {
                /*let c = document.getElementById("controls")
                c.style.width = getViewportWidth() + "px"
                c.style.height = getViewportHeight() + "px"*/
                resize()
                calculate()
            }
            window.onresize = resize
        </script>
        <style>
            * {
                font-size: 5vw;
                padding: 0;
                margin: 0;
            }
            body {
                overflow: hidden;
            }
            #controls {
                display: grid;
                position: absolute;
                bottom: 0;
                left: 0;
                width: 100%;
                grid-template-columns: repeat(4, auto);
                grid-template-rows: repeat(6, 10vw);
                grid-template-areas: 
                    'equ res res res'
                    'cls pop pcl div'
                    'b7 b8 b9 mul'
                    'b4 b5 b6 min'
                    'b1 b2 b3 pls'
                    'b0 b0 pt bsp'
                    ;
            }
            #controls > * {
                border: 1px solid black;
            }
            #equation {
                resize: none;
                border: 0;
                inset: 0;
            }
            #result {
                text-align: center;
            }
        </style>
    </head>
    <body>
        <textarea style="grid-area: eqa" id="equation" name="equation" inputmode="none" onchange="calculate()" onkeyup="calculate()" onfocus="calculate()"></textarea>
        <div id="controls">
            <button style="grid-area: equ" id="equals" onclick="calculate()">=</button>
            <span style="grid-area: res" id="result"></span>
            <button style="grid-area: b0" type="button" onclick="insert('0')">0</button>
            <button style="grid-area: b1" type="button" onclick="insert('1')">1</button>
            <button style="grid-area: b2" type="button" onclick="insert('2')">2</button>
            <button style="grid-area: b3" type="button" onclick="insert('3')">3</button>
            <button style="grid-area: b4" type="button" onclick="insert('4')">4</button>
            <button style="grid-area: b5" type="button" onclick="insert('5')">5</button>
            <button style="grid-area: b6" type="button" onclick="insert('6')">6</button>
            <button style="grid-area: b7" type="button" onclick="insert('7')">7</button>
            <button style="grid-area: b8" type="button" onclick="insert('8')">8</button>
            <button style="grid-area: b9" type="button" onclick="insert('9')">9</button>
            <button style="grid-area: pt" type="button" onclick="insert('.')">.</button>
            <button style="grid-area: pls" type="button" onclick="insert('+')">+</button>
            <button style="grid-area: min" type="button" onclick="insert('-')">-</button>
            <button style="grid-area: mul" type="button" onclick="insert('*')">*</button>
            <button style="grid-area: div" type="button" onclick="insert('/')">/</button>
            <button style="grid-area: pop" type="button" onclick="insert('(')">(</button>
            <button style="grid-area: pcl" type="button" onclick="insert(')')">)</button>
            <button style="grid-area: bsp" type="button" onclick="backspace()">â†¼</button>
            <button style="grid-area: cls" type="button" onclick="cls()">C</button>
        </div>
    </body>
</html>